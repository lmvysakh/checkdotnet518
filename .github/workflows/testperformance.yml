name: Test .NET Setup Performance on Windows

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  test-dotnet-setup:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest, macos-latest]
        dotnet-version: ['6.0.x', '8.0.x']

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Start timer
        id: start
        run: echo "start_time=$(Get-Date -UFormat %s)" >> $GITHUB_OUTPUT
        shell: pwsh

      - name: Setup .NET ${{ matrix.dotnet-version }}
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ matrix.dotnet-version }}

      - name: End timer and calculate duration
        id: end
        run: |
          $end_time = Get-Date -UFormat %s
          $start_time = "${{ steps.start.outputs.start_time }}"
          $duration = [int]$end_time - [int]$start_time
          echo "Setup .NET took $duration seconds"
          echo "duration=$duration" >> $GITHUB_OUTPUT
        shell: pwsh

      - name: Output result
        run: echo "Setup .NET on ${{ matrix.os }} (${{ matrix.dotnet-version }}) took ${{ steps.end.outputs.duration }} seconds."
